public class MainActivity extends AppCompatActivity {
    private AudioRecord audioRecord;
    private WebSocket webSocket;
    private OkHttpClient client;
    private boolean isRecording = false;
    private static final int SAMPLE_RATE = 16000;
    private static final int CHANNEL_CONFIG = AudioFormat.CHANNEL_IN_MONO;
    private static final int AUDIO_FORMAT = AudioFormat.ENCODING_PCM_16BIT;
    private static final int BUFFER_SIZE = AudioRecord.getMinBufferSize(SAMPLE_RATE, CHANNEL_CONFIG, AUDIO_FORMAT) * 4;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        client = new OkHttpClient.Builder()
                .readTimeout(0, TimeUnit.MILLISECONDS)
                .build();
        requestMicPermission();
    }

    private void requestMicPermission() {
        if (ContextCompat.checkSelfPermission(this, Manifest.permission.RECORD_AUDIO) != PackageManager.PERMISSION_GRANTED) {
            ActivityCompat.requestPermissions(this, new String[]{Manifest.permission.RECORD_AUDIO}, 1);
        }
    }

    public void initSession() {
        connectWebSocket();
    }

    public void startStreaming(View view) {
        if (isRecording) return;
        isRecording = true;
        initializeAudioRecord();
        connectWebSocket();
    }

    public void stopStreaming(View view) {
        isRecording = false;
        if (audioRecord != null) {
            audioRecord.stop();
            audioRecord.release();
            audioRecord = null;
        }
        if (webSocket != null) {
            webSocket.close(1000, "Recording stopped");
        }
    }

    private void initializeAudioRecord() {
        audioRecord = new AudioRecord(MediaRecorder.AudioSource.MIC, SAMPLE_RATE, CHANNEL_CONFIG,
                                     AUDIO_FORMAT, BUFFER_SIZE);
        audioRecord.startRecording();
    }

    private void connectWebSocket() {
        Request request = new Request.Builder()
                .url("ws://localhost:8080/audio")  // Your Spring WebSocket endpoint
                 .addHeader("X-Mobile-Number", "+1234567890")
                .build();

        webSocket = client.newWebSocket(request, new WebSocketListener() {
            @Override
            public void onOpen(WebSocket webSocket, Response response) {
                Log.d("WebSocket", "Connected");
                startAudioStreaming();
            }

            @Override
            public void onMessage(WebSocket webSocket, ByteString bytes) {
                // Server responses (if any)
                Log.d("WebSocket", "Received: " + bytes.utf8());
            }

            @Override
            public void onClosing(WebSocket webSocket, int code, String reason) {
                Log.d("WebSocket", "Closing: " + reason);
            }

            @Override
            public void onFailure(WebSocket webSocket, Throwable t, Response response) {
                Log.e("WebSocket", "Error: " + t.getMessage());
            }
        });
    }

    private void startAudioStreaming() {
        new Thread(() -> {
            byte[] buffer = new byte[BUFFER_SIZE];
            while (isRecording && audioRecord != null) {
                int read = audioRecord.read(buffer, 0, BUFFER_SIZE);
                if (read > 0 && webSocket != null) {
                    webSocket.send(ByteString.of(buffer, 0, read));
                }
            }
        }).start();
    }

    @Override
    protected void onDestroy() {
        super.onDestroy();
        stopStreaming(null);
        client.dispatcher().executorService().shutdown();
    }
}
<Button android:id="@+id/startBtn" android:text="Start Streaming"
        android:onClick="startStreaming"/>
<Button android:id="@+id/stopBtn" android:text="Stop Streaming"
        android:onClick="stopStreaming"/>

<uses-permission android:name="android.permission.RECORD_AUDIO" />
<uses-permission android:name="android.permission.INTERNET" />

dependencies {
    implementation 'com.squareup.okhttp3:okhttp:4.12.0'
    implementation 'androidx.core:core-ktx:1.13.1'
}

curl --include --no-buffer \
  -H "Connection: Upgrade" \
  -H "Upgrade: websocket" \
  -H "Host: localhost:8080" \
  -H "Origin: http://localhost:8080" \
  -H "Sec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ==" \
  -H "Sec-WebSocket-Version: 13" \
  -H "Sec-WebSocket-Protocol: v10.stomp, v11.stomp" \
  ws://localhost:8080/audio